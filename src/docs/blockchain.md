# Digital Product Passport – Advanced Architecture and Strategy

## Advanced Cryptographic Infrastructure
To ensure both compliance and privacy, the DPP should use cutting-edge cryptography. Zero-knowledge proofs (ZKPs) can prove statements (e.g. "material X ≥ Y% recycled") without revealing sensitive data. For instance, zk-SNARK or zk-STARK circuits can encode certified attributes (origin, composition) so verifiers learn only “true/false,” not the underlying details.

### Zero-Knowledge Compliance
Our platform now simulates the generation and verification of ZKPs for compliant products. An administrator can trigger this from the **Trust & Verification Hub**. A mock proof is generated and stored, which can then be verified. This demonstrates how a manufacturer can attest to regulatory facts (e.g., “substance levels below legal limits”) without exposing full supplier lists.

### Zero-Knowledge Proof Developer Stack
- **Circom**: A low-level DSL for writing R1CS circuits, offering high performance. It's widely used but requires manual handling of constraints.
- **ZoKrates**: A high-level Rust-based toolbox for zk-SNARKs aimed at Ethereum, simplifying development and integration with Solidity.
- **SnarkyJS (o1js)**: A TypeScript library from the Mina Protocol team, enabling ZK programs in JS/TS, ideal for full-stack ZK apps.
- **Noir**: A Rust-inspired ZKP language focused on usability, compiling to an IR that can target multiple backends (e.g., PLONK).

## Smart Contract Architecture and Anchoring Models

### On-Chain Anchoring
When a product passport is verified, the platform generates a W3C Verifiable Credential (VC) containing the core product data. A hash of this VC is then anchored on-chain (Polygon Amoy testnet in our implementation). This creates an immutable, timestamped proof of the data's integrity at the time of issuance. This process is managed in the **Trust & Verification Hub**.

### Gas Optimization
While our current implementation anchors each VC hash individually, a production-grade system would use techniques like Merkle tree batching to aggregate many credential hashes into a single on-chain transaction, drastically reducing gas costs.

## Verifier and Credential Issuer Onboarding

### Becoming an EBSI-Compliant Issuer/Verifier
Onboarding as a trusted issuer or verifier in the European Blockchain Services Infrastructure (EBSI) ecosystem requires establishing a legal entity DID (e.g., `did:ebsi`), obtaining a Verifiable Authorisation to Onboard, and getting listed in the Trusted Issuers Registry (TIR) on the blockchain. Our platform simulates this by allowing an administrator to mark a company as a "Trusted Issuer" in the **Trust & Verification Hub**. This status is visually represented on the DPP, providing a clear signal of trust to consumers and partners.

### TSP Integration and Qualified Signatures (eIDAS Compliance)
To align with EU regulations, DPP credentials will be signed with high-assurance keys from Trust Service Providers (TSPs). This typically involves obtaining a Qualified Electronic Seal (QSeal) certificate under the eIDAS regulation. The DPP platform will integrate with remote signing services so that each Verifiable Credential is backed by a qualified seal, giving it legal weight across the EU. Our mock implementation uses a wallet private key for signing.

### Role of EUDI Wallets and OIDC4VC in Distribution
The platform will interoperate with the upcoming European Digital Identity (EUDI) Wallet for credential distribution using the OpenID Connect for Verifiable Credentials (OIDC4VC) protocols. A user can scan a product's QR code to receive the DPP credential directly into their wallet. For verification, the holder's wallet can generate a Verifiable Presentation (VP) in response to a request from a verifier's app, ensuring user consent and control.

## JSON-LD Schema Versioning & Credential Revocation

### Evolving JSON-LD Schemas with Backward Compatibility
As DPP schemas evolve, we will use versioned JSON-LD contexts (e.g., `dpp-schema-v2.jsonld`) to maintain backward compatibility. We will leverage JSON-LD 1.1 features like `@version` and `@protected` to manage changes safely. Core terms will be protected to prevent redefinition, and older context URLs will remain stable and accessible.

### Credential Revocation and VC Status Architecture
The platform supports multiple revocation strategies. Our primary implementation uses the **W3C Status List 2021**, a simple and interoperable method using a bitstring to indicate revoked credentials.
-   Each Verifiable Credential (VC) generated by the platform includes a `credentialStatus` field.
-   This field points to a URL (`revocationListUrl`) which is managed by the issuing company. Administrators can set this URL for each company in the **Trust & Verification Hub**.
-   This URL hosts a status list credential (e.g., `status.jsonld`), which verifiers can check to see if a specific VC has been revoked.

This architecture is flexible enough to accommodate other methods like cryptographic accumulators in the future, based on issuer requirements.
